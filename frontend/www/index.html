<html>
    <head>
        <title>Hackaton BEST 2022</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <link rel="stylesheet" type="text/css" href="style.css"/>
    </head>

    <body>
        <div id="container">
            <div id="header">
                <h2> Frontend :) </h2>
            </div>

            <div id="content">
                <div id="nav">
                    <h4>Navigation</h4>
                    <ul>
                        <li><a class="selected" href=""></a> Baza</li>
                        <li><a href=""></a>Nekaj drugega</li>
                        <li><a href=""></a>Nekaj tretjega</li>
                    </ul>
                </div>
                <div id="main">
                    <h2>Baza</h2>
                    <p>Zbrani podatki:</p>
                    <table id="podatki">
                        <tr>
                            <th>Datum</th>
                            <th>Volumen</th>
                        </tr>
                    </table>
                </div>
            </div>

            <div id="footer">
                Copyright &copy; 2022 Amra & boiz
            </div>

            <script src="comms.js"></script>
            <script>
                async function tabela() {
                    let meritve = await getGrouped();

                    for (let i = 0; i < meritve.length - 1; i++) {
                        let volumen1 = meritve[i].round;
                        let volumen2 = meritve[i+1].round;
                        let dnevnaPoraba;

                        if (volumen1 >= volumen2) {
                            meritve[i+1].narobe = false;
                            dnevnaPoraba = volumen1 - volumen2;
                        } else {
                            meritve[i+1].narobe = true;
                            let date = new Date(meritve[i+1].log_date);  // meritve na dan polnjenja
                            let meritveNaDan = await getList(date.getFullYear() + "-" + (date.getMonth() + 1) + "-" + date.getDate());
                            //console.log(meritveNaDan);
                            let j = 0;  // indeks trenutne meritve
                            while (meritveNaDan[j].log_value > meritveNaDan[j + 1].log_value) {  // ok
                                j++;
                            }

                            // j označuje indeks zadnje meritve pred dobavo
                            let delnaRazlika1 = volumen1 - meritveNaDan[j];  // poraba od prejšnjega dneva do tik pred polnitvijo
                            let delnaRazlika2 = meritveNaDan[j+1] - meritveNaDan[meritveNaDan.length - 1];  // poraa od polnitve do polnoči naslednjega dne

                            dnevnaPoraba = delnaRazlika1 + delnaRazlika2;
                        }

                        meritve[i].dnevnaPoraba = dnevnaPoraba;
                    }

                    //console.log(meritve);
                    for (let i = 0; i < meritve.length; i++) {
                        let meritev = meritve[i];
                        let datumCas = new Date(meritev.log_date);

                        /* let ure = datumCas.getHours();
                        if (ure < 10) ure = "0" + ure;
                        let minute = datumCas.getMinutes();
                        if (minute < 10) minute = "0" + minute; */

                        let datumCasString = datumCas.getDate() + "." + (datumCas.getMonth() + 1) + "." + datumCas.getFullYear();

                        let tr = document.createElement("tr");
                        if (meritev.narobe) {
                            tr.style.background = "#ffd0d0";
                        }
                        let td1 = document.createElement("td");
                        let td2 = document.createElement("td");
                        td1.innerHTML = datumCasString;
                        td2.innerHTML = meritev.round;
                        tr.appendChild(td1);
                        tr.appendChild(td2);
                        document.getElementById("podatki").appendChild(tr);
                    }
                }
                tabela();

                let dan = "2021-12-31";  // zadnji dan meritev
                
            </script>
        </div>
    </body> 
</html>